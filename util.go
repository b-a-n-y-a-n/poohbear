package main 

import (
	"net"
	"log"
	"bytes"
	"strings"
)



func csvParse (s *string) map[string]bool {
	mp := make(map[string]bool)
	if *s == "" {
		return mp
	}
	v := strings.Split(*s,",")
	for _, p := range v {
		mp[strings.TrimSpace(p)] = true
	}
	return mp
}


func parseWhiteListPorts(portString *string) map[string]bool {
	return csvParse(portString)
}

func parseWhiteListMACs(macString *string) map[string]bool {
	return csvParse(macString)
}

func parseWhiteListMACPortCombos(macPortString *string) map[string]map[string]bool {
	pass1 := csvParse(macPortString)
	outMap := make(map[string]map[string]bool)
	for k := range pass1 {
		thisSplit := strings.Split(k,"|")
		if len(thisSplit) != 2 {
			log.Fatalf("Unable to parse MAC + port: %v", k)
		}
		thisMAC := strings.TrimSpace(thisSplit[0])
		thisPort := strings.TrimSpace(thisSplit[1])

		// does MAC already exist in map?
		_, alreadyExists := outMap[thisMAC]
		if !alreadyExists {
			outMap[thisMAC] = make(map[string]bool)
		}

		outMap[thisMAC][thisPort] = true

	}
	return outMap
}


func getMacAddr(targetIface string) string {
	interfaces, err := net.Interfaces()
	addr := ""
	if err == nil {
		for _, i := range interfaces {
			// log.Printf("Found interface: %v", i.Name)
			
			if i.Flags & net.FlagUp != 0 && bytes.Compare(i.HardwareAddr, nil) != 0 {	
				// Don't use random as we have a real address
				addrraw := i.HardwareAddr
				// log.Printf("Interface %v has address %v", i.Name, addrraw)
				if i.Name == targetIface {
					addr = addrraw.String()
					log.Printf("Found requested interface. Using %v", addr)
				}
								
			}
		}
	}
	if addr == "" {
		log.Fatalf("Unable to find interface %v", targetIface)
	}
	return addr
}


func PoohBanner() string {
	return `                                                                                                                                                              
                                                                                                                                                               
                                                                                                                                                               .                                                                                                                                                    
                                                                                 #&&&?&/                                                                       
                                                                             #&&(,,,, .?,                                                                      
                                                                           #&&,,,,,,,,.???&.    .&?&&.                                                         
                                                                           *?*,,,,,,,,?&  (??/(??#/&&?,                                                        
                                                               (& &/      .&?/,,,,,,,,&?,,,,(&&&&,,,/??                                                        
                                                              ,??*????&????(?&,,,,,,,(&,,,,,,,,(?/,,,(?&                                                       
                                                           .*?????#,.........,*,,,,,,,,,,,,,,,,,,,,,,,??                                                       
                                                         *????#...........,,,,,,,,,,,,,,,,,,,,,,,,,????                                                        
                                                       ??????,.........?*,,,,,,,,,,,,,,,,,,,,,,,,????                                                          
                                                   .?????/,,,,........??,*,,,,,,,,,,,,,,,,,,,,,,,#?(                                                           
                                                 ?????,,,,,,,,,,.,,,,,?#***,,,,,,,,,,,,,,,,,,,,,,*?/                                                           
                                                ????,,,,,,,,,,,,,,**,*?#***,,,,,,,,,,,,,,,,,,,,,,*?/                                                           
                                               ???,,,,,,,,,,,,,,,,****???**,,,,,,,,,,,,.....,,,,,/?/                                                           
                                             ???*.,,,,,,,,,,,,,,,,*****??**,,,,,,,,,,........,,,,/?*                                                           
                                           (???,..,,,,,,,,,*,,,,(/*****??**,,,,,,,,,,........,,,,??                                                            
                                           /??,..,,,,,,,,,,*????(/,***/?#/?,,,,,,,,,,,......,,,,*?(                                                            
                                          (??*,,,**,,,,,,,,,,,.(???***#?*#?,,,,,,,,,,,.....,,,,.??.                                                            
                                         ???*,/***,,,,,,,,,,,,,,,.??#*#?*#?,,,,,,,,,,......,,,,*?#                                                             
                                       ?????#,****,,,,,,,,,,,,,,,,.??/*?(/?*,,,,#?#,./???????&???&???,                                                         
                                       ????.,******,,,*?#,,,,,,,,,,.??*.??#?#????&&&&(*,,,,,,,,,,,,. ??*                                                       
                                       ??#.***(&*,*(?,,&?(,,,,,,,,,,,??.?*&&&&?/***,,,,,,,*/(((/(#?#/ #?                                                       
                                      .??/*??*&*****???*&?*****,,,,,,(???(*&???#/(?&???&&&&&&&&&?#(/#&???&                                                     
                                      /&&&&**(/**,***&&&&&&*********,,,,&?&&&&///?&&&?#(////*********/&?((?#                                                   
                                      /&?****?**,,*?&?*#&&&&/**********,,,,#&&(&&&&&&?//#&&?#/***//,,&??/?#                                                  
                                      &&/****,,,,,*?/*#?*/&&&&**********,,,,,,,,/,,,#&&&(/**/////*/&&*,..&&                                                  
                                     .&&**,,,,,,,,,,*****/***&&&?********,,,,,,,,,,,,,&&?&&&?#(///,?&*,,,..?&                                                  
                                     ?&&&*,,,,,,,,,,,****///*/?&&&&&/****,,,,,,,,,,,,,,&&&&&&&&?/*,#&*,,,..&&                                                  
                                     &&*&,,,,,,,,,,,,*****//(////*/&&&&&,,,/,,,,,,,,*,,&&&(&?/(#?&&&&&&,,,&&.                                                  
                                    *&?*&,,,,,,,,,,,,,****///&&&///?&&&&??,*&/.?#,&&&&/&?&&&&&&?*,,&&&,                                                  
                                    #&(*&,,,,,,,,,,,,,,****///////#&&?/???&?&@@&&&&&&&&&&(/(&&&&&&?((/**(&(                                                  
                                    &&/&?,,*,,,,,,,,,,,*****///(&&&(//////@@&&&@@?##?&@&&&&??##(((##??&??##&&                                                  
                                    &&/,,**************#?#/*///////////*?@@@@@&&?##??&&&&&&&&&&&?#(((/***&& &&&/                                           
                                    &&,&&&********//,**/&?&&&&&*********(&@@?&&@@@&?#?&&?&##??&&@&&**&&&?,,*?&?                                          
                                    ?&/(#*&*****(&&&&/**********/&&&?***?&&&@@@&?&@&&&&&*,,&&&&@&&?????##(/&&(**#**#&,                                         
           .                         ?&&&*?#*/&&&************&&(***&&&&/&@@@@@@@@@&&&****&&&#?&@@&(((?&(/&***,&&                                         
           .                          ?&&&,&((&&/*********************?&&&@?@@@&??&&*/***/&?&&&??&&@@@@#&?,***&&,                                        
           ............................&/&//&?&&*************************,?&@@@@?&(?*(?,&*&@&&?????&&&&?&&,?&***&&/.............................           
           .............................&&&&(//&&&************************&**,/&&////&/**/&@&@@@&??????#&&******?&(..............................          
           ..............................,&&&///&&&&?/**************************,,#?(/*(&**#&&?#?&&&&&??(/?*****?&(..............................          
            ...............................,&&&//#&&&***?&&**&*******/&/**,,,,,,,*&*////*?/***&&?#((((#??&&&&/*&?***&&,..............................          
            ..................................&&/&&&&&&(*(&&?****,,,,*&,,,,,,,?**///***/&&&&&&&&&&&&&&&&/&****...............................          
            .....................................?&&&&&&&&&?(&&(&&?*,&&&&?&&?,,,,,/**//?(****&&((&&&&/,,,,,,&&**?,#&&. ..............................          
                                                     *&&&&&&&&&&&*/,,/&(,*&&,,*,,*******(*&*.,/((#?&&&&&?&&&&&&(                                .          
                                                             ../&&&&&&&&&&&&&&&,,?,,****#&*&&&&&&&&((/*,,......,                                             
                                                                             ,&&&&&?,,,&&&&&?                                                                  
                                                                                 /&?&&&&&&&.                                                                   
                                                                                     (#/.                                                                      
                                                                                                                                                               
                                                                                                                                                               
`
}